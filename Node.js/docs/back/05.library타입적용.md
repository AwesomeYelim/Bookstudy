# node + typescript 적용하기 (typescript 적용하기)

## 타입 없는 라이브러리 타이핑 적용

Redux.js 따라서 만들기

📍 js 라이브러리에 type 이 지정되어 있는경우는 두가지 경우로 볼수있다.

1. javascript 라이브러리에 따로 typescript를 붙이는 방법
2. 아예 typescript 로 타이핑 -> Redux 처럼

- 우선 passport-local의 type 을 지워준다.

```
yarn remove @types/passport-local
```

- types/express 경로에 passport.local.d.ts 파일을 만든후 다음을 적용(실제로 쓰는 정도에서만 타이핑 해주는것이 좋다.) - declare module "passport-local"로 감싸 ambient 모듈로 만들어줌 

```ts
declare module "passport-local" {
  // toplevel 이어야 함
  import { Strategy as PassportStrategy } from "passport"; // 안쪽에 import 시켜줘야함
  export interface IVerifyOptions {
    [key: string]: string;
  }

  export interface IStrategyOptions {
    usernameFiled: string;
    passwordFiled: string;
  }
  // 여기서는 상대 경로로 import 해올수 없음
  export interface Done {
    // 앞에 인자가 optional 인경우 뒤에 인자가 required 일수 없음
    (error: Error | any, user?: any, options?: IVerifyOptions): void;
  }
  export interface VerifyFunction {
    (username: string, password: string, done: Done): void | Promise<any>;
  }
  export class Strategy extends PassportStrategy {
    constructor(options: IStrategyOptions, verify: VerifyFunction);
  }
}
```

- 다음과 같은 타입 말고도 다른 인자값이 필요한 경우 오버로딩을 통한 타입확장을 진행해주어도 좋다.

🚩 declare 는 언제 사용할까 ?
- 전역으로 타입 사용시(모듈안에 있을시에는 굳이 declare 할 필요 x)

- 만약 open source 에 공유하고 싶다면 다음과 같이 겉에 감쌌던 declare module 을 없애고 사용할 'Strategy' 만 declare 시켜준다.

```ts

  import { Strategy as PassportStrategy } from "passport"; 
  export interface IVerifyOptions {
    [key: string]: string;
  }

  export interface IStrategyOptions {
    usernameFiled: string;
    passwordFiled: string;
  }
  export interface Done {
    (error: Error | any, user?: any, options?: IVerifyOptions): void;
  }
  export interface VerifyFunction {
    (username: string, password: string, done: Done): void | Promise<any>;
  }
  declare class Strategy extends PassportStrategy {
    constructor(options: IStrategyOptions, verify: VerifyFunction);
  }

```
